*=======================================================================
* File:    testp2.f
* Author:  Alex Stivala
* Created: July 2008
*
* testp2 - test harness for dlphs2
*
* $Id: testp2.f 1689 2008-07-16 04:21:41Z astivala $
*=======================================================================

      program testp2

      implicit none

      double precision toler
      parameter (toler = 1.0d-5)

      integer           m,n,j,incx,incy,lda,info,ldq,lde,ldxx,ldaa,ldu,
     $     ldewk,lwork
      parameter         (m = 6, n = 15)
      double precision  ob,blasa,blasb,alpha,lambda,obvalue,beta
      double precision  A(m, n),x(n+1),y(m),b(m),onevec(n),c(n),Q(n,n),
     $     work(m+n)
      double precision  avec(m)
      character         trans

*     workspace arrays for DLPHS2
      double precision E(m+n, m+n),Ewk(m+n, m+n)
      integer ipiv(m+n)
      double precision u(m+n),xxvec(n),gg(n),XX(n,n),AA(m,n),wvec(n)

      external dlphs2

*     BLAS level 1 routines
      external dcopy
*     BLAS level 2 routines
      external dgemv

      lda = m
      ldq = n
      lde = m+n
      ldewk = m+n
      ldxx = n
      ldaa = m
      ldu = m+n
      lwork = m+n

      
      data Q /0.0, 0.0, 0.0, 0.0, 0.0, -0.02d0, 0.0,
     $        0.0, -0.14d0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     0.0, 0.0, 0.0, 0.0, 0.0, -0.015d0, 0.0,
     $        0.0, -0.105d0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     0.0, 0.0, 0.0, -0.02d0, -0.015d0, 0.0, -0.14d0,
     $        -0.105d0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     0.0, 0.0, -0.02d0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     0.0, 0.0, -0.015d0, 0.0, 0.0, 0.0, 0.0, 
     $        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     -0.02d0, -0.015d0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     0.0, 0.0, -0.14d0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     0.0, 0.0, -0.105d0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     -0.14d0, -0.105d0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 /


      data A /1.0, 0.0, 0.0, 1.0, 0.0, 0.0,
     $        1.0, 0.0, 0.0, 0.0, 1.0, 0.0,
     $        1.0, 0.0, 0.0, 0.0, 0.0, 1.0,
     $        0.0, 1.0, 0.0, 1.0, 0.0, 0.0,
     $        0.0, 1.0, 0.0, 0.0, 1.0, 0.0,
     $        0.0, 1.0, 0.0, 0.0, 0.0, 1.0,
     $        0.0, 0.0, 1.0, 1.0, 0.0, 0.0,
     $        0.0, 0.0, 1.0, 0.0, 1.0, 0.0,
     $        0.0, 0.0, 1.0, 0.0, 0.0, 1.0,
     $        1.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 1.0, 0.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 1.0, 0.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 1.0, 0.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 1.0, 0.0,
     $        0.0, 0.0, 0.0, 0.0, 0.0, 1.0/

      data b /m*1.0/

      data c /0.0377777777777777d0,
     $     0.0377777777777777d0,
     $     0.0377777777777777d0,
     $     0.0377777777777777d0,
     $     0.0377777777777777d0,
     $     0.0477777777777777d0,
     $     0.0377777777777777d0,
     $    -0.3122222222222222d0,
     $     0.0377777777777777d0,
     $     0,
     $     0,
     $     0,
     $     0,
     $     0,
     $     0/


      data x /0.2258064516129036d0,
     $     0.2258064516129036d0,
     $     0.2258064516129036d0,
     $     0.2258064516129036d0,
     $     0.2258064516129036d0,
     $     0.2258064516129036d0,
     $     0.2258064516129036d0,
     $     0.2258064516129036d0,
     $     0.2258064516129036d0,
     $     0.3225806451612908d0,
     $     0.3225806451612908d0,
     $     0.3225806451612908d0,
     $     0.3225806451612908d0,
     $     0.3225806451612908d0,
     $     0.3225806451612908d0,
     $     1.0 /


      ob = 1.0
      obvalue = -0.028517340999233d0
      alpha = 0.95
      beta = 0.80
      lambda = 1.0

*     avec = b - A*ones(n,1)
      data onevec /n*1.0/
      trans = 'N'
      blasa = -1.0
      blasb = 1.0
      incx = 1
      incy = 1
      call dcopy(m, b, incx, avec, incy)
      call dgemv(trans, m, n, blasa, A, lda, onevec, incx, blasb,
     $           avec, incy)
      call dlphs2(Q, ldq, A, lda, m, n, c, alpha, beta, lambda, toler,
     $     obvalue, ob, x, y,
     $     E, lde, u, ldu, xxvec, 
     $     gg, XX, ldxx, AA, ldaa, ipiv, wvec, Ewk, ldewk, 
     $     work, lwork, info)


      write(*,290),info
 290  format ('info = ',i4)
      write(*,300),ob
 300  format (' ob = ',f8.4)
      write(*,*),'x = '
      write(*,410), (x(j), j = 1, n)
 410  format (f8.4)
      end

